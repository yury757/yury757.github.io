<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		第五章-创建高性能的索引 | 
	 
	Yury&#39;s Blog
	</title>
	
	<!-- keywords,description -->
	 
		<meta name="description" content="blog of usual study" />
	

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	


	<!-- search -->
	<script>
		var searchEngine = "https://www.google.com/search?q=";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

	
	
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Yury's Blog" type="application/atom+xml">
</head>

<body>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3efe99c287df5a1d6f0d02d187e403c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<header id="header">
    <a id="title" href="/" class="logo">Yury's Blog</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">ABOUT</a>
		</li>
	
		<li class="menu-item">
			<a href="/tags" class="menu-item-link">标签</a>
		</li>
	

	
		<li class="menu-item">
			<a href="/categories" class="menu-item-link">分类</a>
		</li>
	

		<li class="menu-item">
			<a href="https://github.com/yury757" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="按回车全站搜索">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Git
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										learngit
									</a>
									
							<ul>
								<li class="file">
									<a href="/Git/learngit/learn-git">
										learn-git
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										bigdata
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										clickhouse
									</a>
									
							<ul>
								<li class="file">
									<a href="/bigdata/clickhouse/clickhouse">
										clickhouse
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										hadoop
									</a>
									
							<ul>
								<li class="file">
									<a href="/bigdata/hadoop/hadoop-study">
										hadoop-study
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										hbase
									</a>
									
							<ul>
								<li class="file">
									<a href="/bigdata/hbase/HBase-study">
										HBase-study
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										kafka
									</a>
									
							<ul>
								<li class="file">
									<a href="/bigdata/kafka/kafka">
										kafka
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										zookeeper
									</a>
									
							<ul>
								<li class="file">
									<a href="/bigdata/zookeeper/zookeeper-study">
										zookeeper-study
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										computer-science
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Computer-Networking
									</a>
									
							<ul>
								<li class="file">
									<a href="/computer-science/Computer-Networking/Computer-Networking">
										Computer-Networking
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										database
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										mysql
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										MySQL中的exists与in的使用
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/mysql/MySQL%E4%B8%AD%E7%9A%84exists%E4%B8%8Ein%E7%9A%84%E4%BD%BF%E7%94%A8/MySQL%E4%B8%AD%E7%9A%84exists%E4%B8%8Ein%E7%9A%84%E4%BD%BF%E7%94%A8">
										MySQL中的exists与in的使用
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										MySQL备份-Linux版
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/mysql/MySQL%E5%A4%87%E4%BB%BD-Linux%E7%89%88/MySQL%E5%A4%87%E4%BB%BD-linux%E7%89%88">
										MySQL备份-linux版
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										MySQL日期格式化
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/mysql/MySQL%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96/MySQL%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96">
										MySQL日期格式化
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										MySQL查询执行计划详解-explain
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/mysql/MySQL%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E8%AF%A6%E8%A7%A3-explain/MySQL%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E8%AF%A6%E8%A7%A3-explain">
										MySQL查询执行计划详解-explain
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										MySQL迁移数据目录
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/mysql/MySQL%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95/MySQL%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95">
										MySQL迁移数据目录
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										《高性能MySQL》
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										第1章-MySQL架构与历史
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/mysql/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDMySQL%E3%80%8B/%E7%AC%AC1%E7%AB%A0-MySQL%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%8E%86%E5%8F%B2/%E7%AC%AC%E4%B8%80%E7%AB%A0-MySQL%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%8E%86%E5%8F%B2">
										第一章-MySQL架构与历史
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										第2章-MySQL基准测试
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/mysql/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDMySQL%E3%80%8B/%E7%AC%AC2%E7%AB%A0-MySQL%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/%E7%AC%AC%E4%BA%8C%E7%AB%A0%20MySQL%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95">
										第二章 MySQL基准测试
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										第3章-服务器性能剖析
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/mysql/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDMySQL%E3%80%8B/%E7%AC%AC3%E7%AB%A0-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%80%A7%E8%83%BD%E5%89%96%E6%9E%90/%E7%AC%AC%E4%B8%89%E7%AB%A0-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%80%A7%E8%83%BD%E5%89%96%E6%9E%90">
										第三章-服务器性能剖析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										第4章-Schema与数据类型优化
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/mysql/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDMySQL%E3%80%8B/%E7%AC%AC4%E7%AB%A0-Schema%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%8C%96/%E7%AC%AC%E5%9B%9B%E7%AB%A0-Schema%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%8C%96">
										第四章-Schema与数据类型优化
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										第5章-创建高性能的索引
									</a>
									
							<ul>
								<li class="file active">
									<a href="/database/mysql/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDMySQL%E3%80%8B/%E7%AC%AC5%E7%AB%A0-%E5%88%9B%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E7%B4%A2%E5%BC%95/%E7%AC%AC%E4%BA%94%E7%AB%A0-%E5%88%9B%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E7%B4%A2%E5%BC%95">
										第五章-创建高性能的索引
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										postgresql
									</a>
									
							<ul>
								<li class="file">
									<a href="/database/postgresql/postgresql">
										postgresql
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										java
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										JVM
									</a>
									
							<ul>
								<li class="file">
									<a href="/java/JVM/jvm-1.8">
										jvm-1.8
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										SSM-Build
									</a>
									
							<ul>
								<li class="file">
									<a href="/java/SSM-Build/SSM-Build">
										SSM-Build
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										java_JUC
									</a>
									
							<ul>
								<li class="file">
									<a href="/java/java_JUC/Java_JUC-study">
										Java_JUC-study
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										java_NIO
									</a>
									
							<ul>
								<li class="file">
									<a href="/java/java_NIO/Java_NIO-study">
										Java_NIO-study
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/java/java%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE">
										java常用配置
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										mybatis
									</a>
									
							<ul>
								<li class="file">
									<a href="/java/mybatis/mybatis-study">
										mybatis-study
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										springMVC
									</a>
									
							<ul>
								<li class="file">
									<a href="/java/springMVC/SpringMVC-Study">
										SpringMVC-Study
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										springboot
									</a>
									
							<ul>
								<li class="file">
									<a href="/java/springboot/springboot-study">
										springboot-study
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										spring
									</a>
									
							<ul>
								<li class="file">
									<a href="/java/spring/Spring-study">
										Spring-study
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/jetbrains%E7%B3%BB%E5%88%97IDE%E6%8E%A8%E8%8D%90%E8%AE%BE%E7%BD%AE">
										jetbrains系列IDE推荐设置
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										linux
									</a>
									
							<ul>
								<li class="file">
									<a href="/linux/linux%E5%91%BD%E4%BB%A4">
										linux命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										operating-support
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										docker
									</a>
									
							<ul>
								<li class="file">
									<a href="/operating-support/docker/docker">
										docker
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										project
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										flink_data_warehouse
									</a>
									
							<ul>
								<li class="file">
									<a href="/project/flink_data_warehouse/flink_data_warehouse">
										flink_data_warehouse
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	第五章-创建高性能的索引
</h1>
<div class="article-meta">
	
	<span>Yury</span>
	<span>2020-12-01 00:00:00</span>
		<div id="article-categories">
    
		<span>Categories：</span>
            
                
                    <span>
                        <i class="fa fa-folder" aria-hidden="true">
                        <a href="/categories/mysql/">mysql</a>
                        </i>
                      
                    </span>
                
            
    

    
		<span>Tags：</span>
            
    
		</div>

</div>

<div id="article-content">
	<h2 id="〇、索引的本质"><a href="#〇、索引的本质" class="headerlink" title="〇、索引的本质"></a>〇、索引的本质</h2><p>索引本质就是一个排好序的数据结构，实现这种快速排序、插入、查找等操作的数据结构有：平衡二叉树、红黑树、多路查找树（其中平衡的多路查找树就是B-Tree）等。</p>
<h2 id="一、索引的类型"><a href="#一、索引的类型" class="headerlink" title="一、索引的类型"></a>一、索引的类型</h2><h3 id="1、B-Tree索引"><a href="#1、B-Tree索引" class="headerlink" title="1、B-Tree索引"></a>1、B-Tree索引</h3><p>B-Tree，即平衡的多路查找树。具体解释参考其他文章。B-Tree适用于<strong>全键值、键值范围、键前缀查找</strong>。匹配原则如下（只列出了比较重要的）：</p>
<ul>
<li><p>匹配最左前缀：<font color="Blue">where条件中的字段会先匹配索引最左边的字段，如果匹配则适用该索引，并依次匹配后面的字段，直到无效为止，<strong>前面匹配到的字段依然适用索引</strong>；若一开始最左边的字段就不匹配，则不适用于该索引。</font></p>
</li>
<li><p>匹配列前缀：在满足最左前缀的前提下，可以匹配某一列的值的开头部分。如某一个索引字段为（A, B）两个字段，如以下where都是可以使用该索引的。</p>
</li>
</ul>
<pre><code class="mysql">WHERE A = &#39;a&#39; AND B LIKE &#39;b%&#39;
WHERE A LIKE &#39;a%&#39; AND B = &#39;b&#39;
WHERE A LIKE &#39;a%&#39; AND B LIKE &#39;b%&#39;
</code></pre>
<ul>
<li><p>匹配范围值：这里所说的范围查询包括between、in、&gt;、&lt;。</p>
</li>
<li><p>精确匹配前一列，并范围匹配后面的列。</p>
</li>
<li><p>只访问索引的查询，即<strong>索引覆盖</strong>。</p>
</li>
<li><p>order by也可以使用索引，且where字段可以和order by字段拼接来匹配索引。</p>
</li>
</ul>
<h3 id="2、hash索引"><a href="#2、hash索引" class="headerlink" title="2、hash索引"></a>2、hash索引</h3><p>在MySQL中，只有memory引擎显示支持hash索引。hash索引也是memory引擎的默认索引类型。hash索引有以下特征：</p>
<ul>
<li><p>对索引字段使用=，&lt;=&gt;，IN速度特别快，但不支持&gt;和&lt;。</p>
</li>
<li><p>无法使用hash索引来加快order by的速度，因为其不是按照哈希值顺序存储的。</p>
</li>
<li><p>无法使用like匹配前缀来加快查询速度。</p>
</li>
<li><p>hash索引只存储哈希值和行指针，不存储字段值。</p>
</li>
<li><p>当出现hash冲突时，必须遍历冲突值来获取匹配结果。</p>
</li>
</ul>
<h4 id="自适应哈希索引"><a href="#自适应哈希索引" class="headerlink" title="自适应哈希索引"></a>自适应哈希索引</h4><p>InnoDB引擎有一个特殊的功能叫做“自适应哈希索引（adaptive hash index)”。当InnoDB注意到某些索引值被使用得非常频繁时，它会在内存中基于B-Tree索引之上再创建一个哈希索引，这样就让B-Tree索引也具有哈希索引的一些优点，比如快速的哈希查找。这是一个完全自动的、内部的行为，用户无法控制或者配置，不过如果有必要，完全可以关闭该功能。 </p>
<h4 id="自定义哈希索引"><a href="#自定义哈希索引" class="headerlink" title="自定义哈希索引"></a>自定义哈希索引</h4><p>可以通过自定义哈希函数，将对应的字段值通过通过一个自定义哈希函数计算出哈希值列，将这些哈希值额外存在一个字段中。</p>
<p>这样的好处就是，<font color="Red">当需要检索的那些字段很长时，需要的索引也很大，性能较低，而哈希值很短，索引也很小，性能较高。查询时需要查询匹配值的哈希值和匹配值两个字段，哈希值快速缩小范围，当出现冲突时，使用匹配值精确匹配。</font></p>
<pre><code class="mysql">CREATE TABLE pseudohash(
    id int unsigned NOT NULL auto_increment,
    url varchar(255) NOT NULL,
    url_crc int unsigned NOT NULL DEFAULT 0,
    primary key(id)
);

DELIMITER //
CREATE TRIGGER pseudohash_crc_ins BEFORE INSERT ON pseudohash FOR EACH ROW BEGIN
SET NEW.url_crc = crc32(NEW.url);
END;
//
CREATE TRIGGER pseudohash_crc_upd BEFORE UPDATE ON pseudohash FOR EACH ROW BEGIN
SET NEW.url_crc = crc32(NEW.url);
END;
//
DELIMITER ;

insert into pseudohash(url) values (&#39;http://www.mysql.com&#39;);

select * from pseudohash where url_crc = CRC32(&#39;http://www.mysql.com&#39;) and url = &#39;http://www.mysql.com&#39;;
</code></pre>
<h3 id="3、空间数据索引（R-Tree）"><a href="#3、空间数据索引（R-Tree）" class="headerlink" title="3、空间数据索引（R-Tree）"></a>3、空间数据索引（R-Tree）</h3><p>MyISAM引擎支持R-Tree，可以用于存储空间相关数据，如地理数据。</p>
<h3 id="4、全文索引（FULLTEXT）"><a href="#4、全文索引（FULLTEXT）" class="headerlink" title="4、全文索引（FULLTEXT）"></a>4、全文索引（FULLTEXT）</h3><p>全文索引是一种特殊类型的索引，它查找的是文本中的关键词，而不是直接比较索引中的值，更类似于搜索引擎做的事。</p>
<p>简单介绍几个全文索引的特点，有需要去查看官方文档或其他文章。</p>
<ul>
<li>只能构建在char、varchar、text类型上</li>
<li>通过全文索引的查询有自己特殊的语法<code>match(index_column) again(&#39;xxxx&#39;)</code></li>
<li>全文索引的检索有最小搜索长度和最大搜索长度限制（可以通过修改my.ini修改配置），表的行数量条件要求，以及各种殷勤和版本限制等。</li>
</ul>
<h2 id="二、索引的优点"><a href="#二、索引的优点" class="headerlink" title="二、索引的优点"></a>二、索引的优点</h2><ul>
<li>大大减少了服务器需要扫描的数据量</li>
<li>帮助服务器避免了排序或临时表</li>
<li>将随机IO变为顺序IO</li>
</ul>
<h3 id="额外的IO知识"><a href="#额外的IO知识" class="headerlink" title="额外的IO知识"></a>额外的IO知识</h3><ul>
<li><p><font color="Blue">IO请求的时间主要有三块：寻道时间、旋转延迟、数据传输时间。寻道时间 &gt; 旋转延迟 &gt; 数据传输时间。</font></p>
</li>
<li><p><font color="Blue">顺序IO是指读写操作的访问地址连续，寻址时间极大减少，性能高。随机IO是指读写操作访问地址不连续，磁头需要不停的移动，时间都浪费在磁头寻址上了，所以性能较差。</font></p>
</li>
</ul>
<p><font color="Blue">详见：<a target="_blank" rel="noopener" href="https://tech.meituan.com/2017/05/19/about-desk-io.html">https://tech.meituan.com/2017/05/19/about-desk-io.html</a></font></p>
<h2 id="三、高性能的索引策略"><a href="#三、高性能的索引策略" class="headerlink" title="三、高性能的索引策略"></a>三、高性能的索引策略</h2><h3 id="1、提高索引的选择性"><a href="#1、提高索引的选择性" class="headerlink" title="1、提高索引的选择性"></a>1、提高索引的选择性</h3><p><font color="Red">索引的选择性</font>，是指不重复的索引值和表的总记录数的比值，即count(distinct column) / count(1)的值。</p>
<p>索引的选择性越高，则查询效率越高，因为选择性高的索引可以让MySQL在查询时过滤掉更多的行。对应的可以在explain中查看filtered字段，filtered越高说明通过索引过滤掉的行越多，索引效率越高。</p>
<p>在char、varchar、text上可以构建前缀索引，即指定长度来对字符串的前几个字符构建索引。text必须使用<font color="Red">前缀索引</font>，varchar可以不指定前缀长度。然而varchar很长时，会导致索引很大效率低，构建一个较短的前缀索引还是有必要的。<font color="Red">关键在于，要使前缀索引对记录的过滤率（选择性）尽可能向完整长度索引对记录的过滤率（选择性）靠近。这样既达到了提高效率节省空间的作用，还实现了高效的数据查询。</font></p>
<pre><code class="mysql">SELECT COUNT(DISTINCT city)/COUNT(*) FROM sakila.city_demo;

SELECT
COUNT(DISTINCT LEFT(city, 3))/COUNT(*) AS sel3，
COUNT(DISTINCT LEFT(city, 4))/COUNT(*) AS sel4，
COUNT(DISTINCT LEFT(city, 5))/COUNT(*) AS sel5，
COUNT(DISTINCT LEFT(city, 6))/COUNT(*) AS sel6，
COUNT(DISTINCT LEFT(city, 7))/COUNT(*) AS sel7
FROM sakila.city_demo；
</code></pre>
<h3 id="2、多列索引"><a href="#2、多列索引" class="headerlink" title="2、多列索引"></a>2、多列索引</h3><p>应该构建合适的多列索引，而不是对每一列构建一个索引。</p>
<h3 id="3、索引顺序"><a href="#3、索引顺序" class="headerlink" title="3、索引顺序"></a>3、索引顺序</h3><p><font color="Red">将选择性最高的索引放在索引最前列。</font></p>
<h3 id="4、聚簇索引"><a href="#4、聚簇索引" class="headerlink" title="4、聚簇索引"></a>4、聚簇索引</h3><p><font color="Red">聚簇索引</font>：在B+Tree的基础上，每个叶子节点不仅有索引字段值，还有该索引字段对应的实际的数据行。因为无法把数据行放在两个不同的地方，因此一个表只能有一个聚簇索引，实际上聚簇索引“就是”表本身。<font color="Red">聚簇索引并不是一种基本索引类型，而是一种数据分布策略。</font></p>
<p>对于InnoDB，如果有主键，则主键就是聚簇索引；如果未定义主键，则会使用unique键字段作为聚簇索引；如果都没有，则会隐式定义一个主键作为聚簇索引。</p>
<p>二级索引定位行需要两次查找，第一次定位到二级索引上保存的即聚簇索引键，第二次通过聚簇索引键定位到实际的行数据。</p>
<h3 id="5、InnoDB和MyISAM的数据分布对比"><a href="#5、InnoDB和MyISAM的数据分布对比" class="headerlink" title="5、InnoDB和MyISAM的数据分布对比"></a>5、InnoDB和MyISAM的数据分布对比</h3><h4 id="（1）MyISAM"><a href="#（1）MyISAM" class="headerlink" title="（1）MyISAM"></a>（1）MyISAM</h4><ul>
<li>不支持聚簇索引，数据是按照插入顺序存储在磁盘中的。</li>
<li>在数据之外还有一个行号，用于查找该行的指针。</li>
<li><font color="Red">主键索引和二级索引没有本质区别，分布方式都是把索引列排序后加上行号，因此无论是主键索引还是二级索引，都要通过两次寻址才能获取数据。</font></li>
</ul>
<img src="/images/MyISAM数据分布.png" style="zoom:50%;">

<h4 id="（2）InnoDB"><a href="#（2）InnoDB" class="headerlink" title="（2）InnoDB"></a>（2）InnoDB</h4><ul>
<li>数据是按照主键大小排序插入，若没有设置主键，则会给定一个隐式自增主键。这个主键代替MyISAM的行号。</li>
<li>支持聚簇索引，聚簇索引已经包含了整个表的数据，且还包含了事务ID、用于事务和MVCC的回滚指针等其他数据。</li>
<li>二级索引只有索引列和主键列。<font color="Red">因此通过主键查找行只要一次寻址，而通过二级索引还是需要两次寻址。</font></li>
</ul>
<img src="/images/InnoDB和MyISAM的区别.PNg" style="zoom:50%;">

<h4 id="（3）Tips"><a href="#（3）Tips" class="headerlink" title="（3）Tips"></a>（3）Tips</h4><p><font color="Red">在IO密集的应用中，最好避免使用随机的主键（如UUID）来做聚簇索引的主键，原因如下：。</font></p>
<ul>
<li>每次生成的UUID不一定比之前的大，所以InnoDB无法简单地将新行插入到索引的最后面，要找到合适的位置，就会导致大量的随机IO</li>
<li>因为写入是乱序的，InnoDB不得不频繁地做页分裂操作，以便为新的行分配空间。页分裂会导致移动大量数据，一次插入最少需要修改三个页而不是一个页。</li>
<li>由于频繁的页分裂，页会变得稀疏并被不规则地填充，所以最终数据会有碎片。</li>
</ul>
<h4 id="（4）auto-increment的缺点"><a href="#（4）auto-increment的缺点" class="headerlink" title="（4）auto_increment的缺点"></a>（4）auto_increment的缺点</h4><p>在高并发的情况下，在InnoDB中按主键顺序插入可能会造成明显的争用。一方面主键的上界会成为热点，因为所有的插入操作都在这里，高并发可能会导致<font color="Red">间隙锁</font>（简单来说就是主键键值之间的距离的锁，该锁可以阻塞insert操作，防止幻读）竞争。另一方面，auto_increment的锁机制也是一个热点。如果遇到插入争用问题，则可能需要考虑重新设计表结构或者应用，或者更改innodb_autoinc_lock_mode配置。</p>
<h3 id="6、覆盖索引"><a href="#6、覆盖索引" class="headerlink" title="6、覆盖索引"></a>6、覆盖索引</h3><p>定义：如果一个索引包含（或者说覆盖）所有需要查询的字段，则称这个情况为“覆盖索引”。</p>
<p>覆盖索引是针对某一个sql语句来判断的，所以只能称之为一种特殊情况。</p>
<p>出现“覆盖索引”时，查询数据不需要回表，因为索引中已经有了我们需要的数据，因此覆盖索引的效率很高。</p>
<h3 id="7、使用索引来优化排序"><a href="#7、使用索引来优化排序" class="headerlink" title="7、使用索引来优化排序"></a>7、使用索引来优化排序</h3><h4 id="Tips-1"><a href="#Tips-1" class="headerlink" title="Tips 1"></a>Tips 1</h4><p><font color="Red">出现“覆盖索引”时，在explain中的extra字段会出现“using index”值。而explain中的type字段中的“index”意思是访问数据的类型，例如全表扫描、范围扫描、索引扫描、常数引用等，对于索引扫描，意思是，访问数据只需要扫描索引，不需要回表查找数据。</font></p>
<h4 id="Tips-2"><a href="#Tips-2" class="headerlink" title="Tips 2"></a>Tips 2</h4><p><font color="Red">如果查询需要关联多张表，则只有当order by子句引用的字段都是第一张表时，才能使用索引进行排序。</font></p>

</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/database/mysql/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDMySQL%E3%80%8B/%E7%AC%AC3%E7%AB%A0-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%80%A7%E8%83%BD%E5%89%96%E6%9E%90/%E7%AC%AC%E4%B8%89%E7%AB%A0-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%80%A7%E8%83%BD%E5%89%96%E6%9E%90">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  第三章-服务器性能剖析
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/database/mysql/MySQL%E5%A4%87%E4%BB%BD-Linux%E7%89%88/MySQL%E5%A4%87%E4%BB%BD-linux%E7%89%88">
                
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>




<script>
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>